{%  load staticfiles %}

    <script src="{% static 'javascript/jquery.min.js' %}"></script>
  <script src="{% static 'javascript/jquery-migrate.min.js' %}"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="{% static 'javascript/jquery-migrate.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

{%  load staticfiles %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Political Sentimental Analysis</title>

  <!-- Bootstrap -->
  <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <link rel="stylesheet" href="{% static "css/animate.css" %}">
  <link href="{% static "css/animate.min.css" %}" rel="stylesheet">
  <link href="{% static "css/style.css" %}" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css?family=Kanit:100i,200&display=swap" rel="stylesheet">


</head>

<body>


!--Navbar-->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top scrolling-navbar">
      <div class="container">
        <a class="navbar-brand" href="{% url 'index' %}">
          <strong><img src="{% static 'images/image/logo.png' %}" height="40px"></strong>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent-7"
          aria-controls="navbarSupportedContent-7" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent-7">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item  {{ home_page }}">
                    <a class="nav-link" href="{% url 'index' %}">Home
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item {{ about_page }}">
                    <a class="nav-link " href="{% url 'about' %}">About</a>
                </li>

                <li class="nav-item {{ contact_page }}">
                    <a class="nav-link " href="{% url 'contact' %}">
                        Contact
                      </a>
                </li>
            </ul>
        </div>
      </div>
    </nav>


  <div class=" pt-3 mt-5" style="background-color: #FBFBFB ">
      <div class="container">
          <div class="row ">
              <div class="col col-md-6 col-12">
                    <div class="card card-stats">
                        <div class="card card-header"style="background-color: #F7FCAD   " >
                            <h3>Classification Analysis Chart</h3>
                        </div>
                        <div class="card card-body">
                            <canvas id="myChart" width="30" height="20">
                            </canvas>

                        </div>
                    </div>
              </div>
          <div class="col col-md-6 col-12">
                <div class="row">
                    <div class="col col-md-12 col-12">
                    <div class="card">
                        <div class="card-header"style="background-color: #C0FCAD  ">
                            <h3>Accuracy Score</h3>
                        </div>
                        <div class="card-body">
                            <div class="progress">
                                 <div class="progress-bar" role="progressbar" aria-valuenow="60"
                            aria-valuemin="0" aria-valuemax="100" style="width:60%; background-color: green ">
                                 60%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    <div class="col col-md-12 col-12">
                         <div class="card mt-3">
                        <div class="card-header" style="background-color: #FCB0AD  ">
                            <h3>Loss Score</h3>
                        </div>
                        <div class="card-body">
                            <div class="progress">
                                 <div class="progress-bar" role="progressbar" aria-valuenow="40"
                            aria-valuemin="0" aria-valuemax="100" style="width:40%; background-color: red">
                                 40%
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
          </div>
          </div>
            <div class="row py-3 my-3">
            <div class="col col-md-12 col-12">
                <div class="card">
                    <div class="card-header" style="background-color: #D8F9F8 ">
                        <h3>Chart Data Clustering</h3>
                    </div>
                    <div class="card-body" style="padding-bottom: 200px">
                        <div class="row">
                            <div class="container">
                                <button class="btn btn-success" onclick="chartCuster('/api/chart/datapositive?z='
                                 + window.location.search.substring(1).split('z=')[1])">Positive</button>
                                <button class="btn btn-danger" onclick="chartCuster('/api/chart/datanegative?z=' 
                                + window.location.search.substring(1).split('z=')[1])">Negative</button>
                                <button class="btn btn-primary" onclick="chartCuster('/api/chart/dataneutral?z='
                                 + window.location.search.substring(1).split('z=')[1])">Neutral</button>
                            </div>
                        </div>
                        <div class="container mt-4">
                            <canvas id="positive" width="30" height="20"></canvas>
                        </div>

                    </div>
                </div>
            </div>
            </div>
      </div>
  </div>

{#footer#}
<div class="sub-footer"style="margin-top:15px">
    <div class="container">
      <div class="social-icon">
        <div class="col-md-12">
          <ul class="social-network">
            <li><a href="#" title="Facebook"><i class="fab fa-facebook-square"></i></a></li>
            <li><a href="#" title="Github"><i class="fab fa-github"></i></a></li>
            <li><a href="#" title="Google Plus"><i class="fab fa-google-plus"></i></a></li>
          </ul>
        </div>
        </div>
        </div>
      </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="{% static 'javascript/jquery.min.js' %}"></script>
  <script src="{% static 'javascript/jquery-migrate.min.js' %}"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="{% static 'javascript/jquery-migrate.min.js' %}"></script>
  <script src="{% static ' javascript/wow.min.js' %}"></script>
        <script  src="https://code.jquery.com/jquery-3.4.1.js"> </script>
  <script  src="{% static 'javascript/jquery.easypiechart.js' %}"> </script>
<script src ="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>
        <script>
    $(function() {
        $('.chart').easyPieChart({
            //your options goes here
        });
    });
    </script>
  <script>
    wow = new WOW({}).init();
    
  </script>



 <script>
    var endpoint = '/api/chart/data?z=' + window.location.search.substring(1).split("z=")[1];
      $.ajax({
      method : "GET",
      url : endpoint,
      success:function (data) {
      const sentimentType = Object.keys(data.data);
      console.log(sentimentType );
      var ctx = document.getElementById('myChart');
      var myChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ["Negative","Neutral","Positive"],
              datasets: [{
                  data: sentimentType.map(key => data.data[key]),
                  backgroundColor: [
                                    '#dc3545','#007bff','#28a745',
                                   ],
                   borderColor: ['#dc3545','#007bff','#28a745'],

                   borderWidth: 1
                        }]
              },
                  showDatapoints: true,
                         options: {
                          tooltips: {
                                      enabled: true
                                    },
                          responsive: true,
                          legend: {
                                      position: 'right',
                                  },
                          animation: {
                                      animateScale: true,
                                      animateRotate: true
                                      },
                          plugins : {
                                      labels : {
                                                position : 'outside',
                                                font:{
                                                    size: 20,
                                                    weight: 'bold'
                                                }
                                               }
                                   }}
                                                });
                      },
      error:function (error_data){
      console.log(error_data)
      }
      });



                                 var myChart2;
                                 var ctx2;
                                 function chartCuster(urls) {
                                     $.ajax({
                                          method : "GET",
                                          url : urls,
                                          success:function (data) {
                                              const sentimentType = Object.keys(data.data);

                                              if (myChart2) {

                                                  myChart2.data.labels = sentimentType;
                                                  myChart2.data.datasets.forEach((dataset,index) => {
                                                      dataset.data =sentimentType.map(key => data.data[key])
                                                  });
                                                  myChart2.update();
                                              }
                                              else {
                                                  ctx2 = document.getElementById('positive').getContext('2d');
                                                  myChart2 = new Chart(ctx2, {
                                                  type: 'bar',

                                                  data: {
                                                      labels: sentimentType,
                                                      datasets: [{
                                                          data: sentimentType.map(key => data.data[key]),

                                                          backgroundColor: [
                                                              'rgba(255, 99, 132, 0.8)',
                                                              'rgba(54, 162, 235, 0.8)',
                                                              'rgba(65, 249, 87, 0.8)',
                                                              'rgba(234, 226, 87 , 0.8)',

                                                              'rgba(220, 65, 225 , 0.8)',
                                                              'rgba(255, 129, 25 , 0.8)',
                                                              'rgba(25, 255, 236 , 0.8)',
                                                          ],
                                                          borderColor: [
                                                              'rgba(255, 99, 132, 0.8)',
                                                              'rgba(54, 162, 235, 0.8)',
                                                              'rgba(65, 249, 87, 0.8)',
                                                              'rgba(234, 226, 87 , 0.8)',

                                                              'rgba(220, 65, 225 , 0.8)',
                                                              'rgba(255, 129, 25 , 0.8)',
                                                              'rgba(25, 255, 236 , 0.8)',
                                                          ],
                                                          borderWidth: 1
                                                      }]
                                                  },

                  options: {
                      tooltips: {
                                 enabled: false
                                },
                      scales: {
                                    xAxes: [{
                                        ticks: {
                                            fontSize: 16
                                        }
                                    }]
                                },
                      responsive: true,
                      legend: {
                              display : false
                             },
                      animation: {
                                  animateScale: true,
                                  animateRotate: true,
                                   "duration": 1,
                                    "onComplete": function() {
                                        var chartInstance = this.chart,
                                        ctx = chartInstance.ctx;
                                        ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, 
                                        Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                                        ctx.textAlign = 'center';
                                        ctx.textBaseline = 'bottom';

                                          this.data.datasets.forEach(function(dataset, i) {
                                            var meta = chartInstance.controller.getDatasetMeta(i);
                                            meta.data.forEach(function(bar, index) {
                                                var data = dataset.data[index];
                                                ctx.fillText(data, bar._model.x, bar._model.y - 5);
                                                                      });
                                                                    });
                                                                  }
                                                      },
                                                      plugins: {
                                                          labels: {
                                                              position: 'outside',
                                                              render: function (args) {
                                                              }

                                                          }
                                                      }
                                                  }
                                              })
                                          }
                                          },
                                          error:function (error_data){
                                              console.log(error_data)
                                          }
                                     });
                                 }


                                </script>

</body>
</html>
